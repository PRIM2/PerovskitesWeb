<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>PeroWeb Log In</title>
    <link rel="icon" type="image/jpg" href="baseLayout/icono.jpg">

    <link href="sesion/signIn.css" rel="stylesheet" />

    <!-- Select2 & jQuery -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    
    <!-- Latex y MathJax -->
    <!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> -->
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    
</head>

<body>
    <!-- ___ *** HEADER *** ___ -->
    <div id="header"></div>


    <div class="main-container">
        <div class="containerDatosEntrada">
            <!-- ___ *** MAIN *** ___ -->
            <h1>Crear cuenta nueva (no implementado)</h1>
            <br>
            <form style="font-style: italic;" id="miFormulario">
                <div class="input-containerS">
                    <label for="name">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Nombre:</label>
                    <br>
                    <input id="name" type="text" class="styled-inputS">
                    <br><br>
                    <label for="surname">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Apellidos:</label>
                    <br>
                    <input id="surname" type="text" class="styled-inputS">
                    <br><br>
                    <label for="mail">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Correo electr√≥nico:</label>
                    <br>
                    <input id="mail" type="email" class="styled-inputS">
                    <br><br>
                    <label for="password">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Contrase√±a:</label>
                    <br>
                    <input id="password" type="password" class="styled-inputS">
                    <br><br>
                    <label for="repassword">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Repetir contrase√±a:</label>
                    <br>
                    <input id="repassword" type="password" class="styled-inputS">
                </div>
            
                <p id="mensajeError" style="color: red; display: none;">‚ö†Ô∏è Las contrase√±as no coinciden</p>
            
                <div class="button-container">
                    <button type="button" class="styled-button" onclick="comprobarCampos()">
                        Crear cuenta
                    </button>
                </div>
            </form>
            
            <script type="module">
                import { registrarUsuario } from "./dataBase/dataHandler.js";

                function esCorreoValido(mail) {
                    let regexCorreo = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
                    return regexCorreo.test(mail);
                }

                async function comprobarCampos() {
                    let password = document.getElementById("password").value;
                    let repassword = document.getElementById("repassword").value;
                    let name = document.getElementById("name").value.trim();
                    let surname = document.getElementById("surname").value.trim();
                    let mail = document.getElementById("mail").value.trim();

                    // Verifica que nombre y apellido no est√©n vac√≠os
                    if (name === "" || surname === "") {
                        alert("‚ö†Ô∏è El nombre y los apellidos no pueden estar vac√≠os. ‚ùå‚ùå");
                        return false;
                    }

                    if (!esCorreoValido(mail)) {
                        alert("‚ö†Ô∏è El correo ingresado no es v√°lido. ‚ùå‚ùå");
                        return false
                    }

                    // Verifica que la contrase√±a tenga m√°s de 6 caracteres
                    if (password.length < 8) {
                        alert("‚ö†Ô∏è La contrase√±a debe tener al menos 6 caracteres. ‚ùå‚ùå");
                        return false;
                    }

                    // Verifica que las contrase√±as coincidan
                    if (password !== repassword) {
                        alert("‚ö†Ô∏è Las contrase√±as no coinciden. ‚ùå‚ùå");
                        return false;
                    }
                    let info = await registrarUsuario(name, surname, mail, password);
                    if (!info) {
                        alert("algo va mal en dataHandler o supabase intentalo en 2 minutos sino contacta conmigo");
                        return false;
                    }

                    alert("üòÄ Todo correcto, cuenta creada üòÄ");
                        window.location.href = "logIn.html"; // Redirige si las contrase√±as coinciden
                    return true;
                }
                window.comprobarCampos = comprobarCampos;
            </script>
            
            <a href="logIn.html">¬øYa tienes cuenta?</a>

        </div>

        <!-- ___ *** ASIDE *** ___ -->
        <div id="aside"></div>    
    </div>    

    <!-- ___ *** FOOTER *** ___ -->
    <div id="footer"></div>


    <!-- ___ *** Librerias .js ___ *** -->
    <script src="baseLayout/layoutLoader.js"></script>
    <script type="module" src="baseLayout/upheader.js"></script>

</body>
</html>
